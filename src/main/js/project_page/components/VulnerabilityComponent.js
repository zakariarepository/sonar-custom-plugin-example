import React, { useState, useEffect, useRef } from 'react';
import ButtonGroup from '@mui/material/ButtonGroup';
import Button from '@mui/material/Button';
import LabelImportantIcon from '@mui/icons-material/LabelImportant';

const VulnerabilityComponent = ({ sectionId, vulnerability, isSelected  }) => {
  const { title, priority, category, where, risk, assess, fix } = vulnerability;
  const [isVisible, setIsVisible] = useState(isSelected);
  const [activeButton, setActiveButton] = useState(1);
  const contentButton = useRef(null);

  const handleClick = (event) => {
    const target = event.target.closest(".sButton"); // Or any other selector.
    if(target){
      setActiveButton(event.target.getAttribute("id"));
      console.log(event.target.getAttribute("id"))
    }
  };

  useEffect(() => {
    contentButton.current.addEventListener('click', handleClick);
    return () => {
      contentButton.current.removeEventListener('click', handleClick);
    };
  }, []);

  useEffect(() => {
    setIsVisible(isSelected);
  }, [isSelected]);

  return (
    <div className={`vulnerability ${isVisible ? 'visible' : 'hidden'}`} id={`${sectionId}`}>
    <div>
      <div className="content-header-container">
        <div >
          <h2>
            <span >{vulnerability["title"]}</span>
            <button aria-label="Click to copy to clipboard"   type="button">
              <svg aria-hidden="true" focusable="false" role="img" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" >
                <path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path>
              </svg>
            </button>
          </h2>
          <div >
            <span >Hard-coded credentials are security-sensitive</span>
            <a href="/coding_rules?open=typescript%3AS2068&amp;rule_key=typescript%3AS2068" target="_blank" >typescript:S2068</a>
          </div>
          <div className="to-review-container" >
            <div className="to-review-container-text">
              <h3>
                <span>Status: To review</span>
              </h3>
              <div>
                <span >This security hotspot needs to be reviewed to assess whether the code poses a risk.</span>
              </div>
            </div>
            <div className="center-review" >
              <button id="status-trigger" className="eslc3qc0 css-l0dgt9 e14gv5kq0" aria-disabled="false" type="button" >Review</button>
            </div>
          </div>
        </div>
        <div >
          <div>
            <div >Review priority:</div>
            <div className='review-priority'>
              <LabelImportantIcon className='high-label' />
              <span >{vulnerability["priority"]}</span>
            </div>
          </div>
          <div >
            <div >Category:</div>
            <span >{vulnerability["category"]}</span>
          </div>
          <div >
            <div>Assignee:</div>
            <div aria-label="Click to change assignee"   >
              <span >
                <span >Administrator</span>
                <div >
                </div>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div >
      <div>
        <ButtonGroup variant="outlined" aria-label="Basic button group" className="radiogroup" ref={contentButton}>
                <Button  id="1" className='sButton'>Where is the risk?</Button>
                <Button  id="2" className='sButton'>What's the risk?</Button>
                <Button  id="3" className='sButton'>Assess the risk</Button>
                <Button  id="4" className='sButton'>How can i fix it?</Button>
                <Button  id="5" className='sButton'>Activity</Button>
        </ButtonGroup>
      </div>
      <div className={`${activeButton == 1 ? 'visible' : 'hidden'}`} >
        <div className="ide-reverence-container">
          <span >
            <span>src/main/java/pl/piomin/CustomRulesDefinition.java</span>
            <button aria-label="Copy the file path to the clipboard"  data-clipboard-text="frontend/src/app/Services/two-factor-auth-service.spec.ts" aria-describedby="tooltip-550" type="button" >
              <svg aria-hidden="true" focusable="false" role="img" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" >
                <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
                <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
              </svg>
            </button>
          </span>
          <div>
            <button  type="button">Open in IDE <div >
                <div >
                  <div aria-live="polite" role="status"></div>
                </div>
              </div>
            </button>
          </div>
        </div>
        <div><p>{vulnerability["where"]}</p></div>
      </div>
      <div className={`${activeButton == 2 ? 'visible' : 'hidden'}`} ><p>{vulnerability["risk"]}</p></div>
      <div className={`${activeButton == 3 ? 'visible' : 'hidden'}`} ><p>{vulnerability["assess"]}</p></div>
      <div className={`${activeButton == 4 ? 'visible' : 'hidden'}`} ><p>{vulnerability["fix"]}</p></div>
      <div className={`${activeButton == 5 ? 'visible' : 'hidden'}`} ><p>AI Based Security Hotspot created</p></div>
    </div>
  </div>
  );
};

export default VulnerabilityComponent;
